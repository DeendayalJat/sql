USE dd;
CREATE TABLE events (
  event_id   INT PRIMARY KEY,
  event_name VARCHAR(100) NOT NULL,
  city       VARCHAR(50)  NOT NULL
);
CREATE TABLE ticket_sales (
  sale_id          INT PRIMARY KEY,
  event_id         INT NOT NULL,
  sale_date        DATE NOT NULL,
  ticket_type      VARCHAR(20) NOT NULL,
  qty              INT NOT NULL,
  price_per_ticket INT NOT NULL,
  CONSTRAINT fk_ticket_sales_event
    FOREIGN KEY (event_id) REFERENCES events(event_id)
);
INSERT INTO events (event_id, event_name, city) VALUES
(1, 'Music Fest', 'Mumbai'),
(2, 'Tech Summit', 'Bengaluru'),
(3, 'Food Carnival', 'Delhi'),
(4, 'Startup Meetup', 'Mumbai');
INSERT INTO ticket_sales (sale_id, event_id, sale_date, ticket_type, qty, price_per_ticket) VALUES
(101, 1, '2025-01-05', 'Regular', 2, 1500),
(102, 1, '2025-01-10', 'VIP',     1, 5000),
(103, 2, '2025-02-03', 'Regular', 3, 2000),
(104, 2, '2025-02-10', 'VIP',     1, 6000),
(105, 3, '2025-03-01', 'Regular', 5,  800),
(106, 3, '2025-03-15', 'VIP',     2, 2500),
(107, 4, '2025-01-20', 'Regular', 4, 1200),
(108, 4, '2025-02-05', 'Regular', 1, 1200);
SELECT * FROM events ORDER BY event_id;
SELECT * FROM ticket_sales ORDER BY sale_id;
select event_id,sum(qty) from ticket_sales group by event_id;
select event_id,sum(qty*price_per_ticket) from ticket_sales group by event_id;
select month(sale_date) as m,sum(qty*price_per_ticket) from ticket_sales group by m;
select event_id,max(price_per_ticket)from ticket_sales group by event_id;
select month(sale_date) as m , ticket_type,sum(qty*price_per_ticket) from ticket_sales group by m,ticket_type ;
select sale_id,event_name,sale_date from ticket_sales as ts 
join events as e 
on ts.event_id=e.event_id;
select event_name,ticket_type,qty from ticket_sales ts
natural join events e ;
select sale_id,event_name,city,sale_date from ticket_sales ts
natural join events e
where city='Mumbai';
-- also with inner join
select sale_id,event_name,city,sale_date from ticket_sales ts
inner join events e
on e.event_id=ts.event_id
where city='Mumbai';
-- also use left join
select event_name ,sale_id, sale_date from ticket_sales ts
natural join events e;
-- select distinct event_name from events;
SELECT DISTINCT e.event_name
FROM events e
JOIN ticket_sales ts
  ON e.event_id = ts.event_id;
select sale_id,event_name,sum(qty*price_per_ticket)  as revenue from ticket_sales
natural join events group by sale_id;
select event_name,sum(qty) quantity from events
natural join ticket_sales group by event_name;
SELECT e.event_name,SUM(ts.qty) AS quantity
FROM events e
JOIN ticket_sales ts
  ON e.event_id = ts.event_id
GROUP BY e.event_name;
select  e.event_name,sum(ts.qty*ts.price_per_ticket) as revenue_vip FROM events e
 JOIN ticket_sales ts
ON e.event_id = ts.event_id
where ticket_type='VIP'
GROUP BY e.event_name order by e.event_name;
select e.city,month(ts.sale_date) as sale_month,sum(ts.qty*ts.price_per_ticket) as total_revenue
from events e
join ticket_sales ts
on e.event_id = ts.event_id
group by e.city,sale_month order by e.city;



